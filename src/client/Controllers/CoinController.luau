--[[
	CoinController - Contr√¥leur de collecte de pi√®ces
	G√®re la logique quand le joueur collecte une pi√®ce
]]

local ReplicatedStorage = game:GetService("ReplicatedStorage")

local CoinController = {}

-- D√©pendances (inject√©es depuis init.client)
local SoundManager = nil
local CollectEffects = nil
local CameraEffects = nil

-- Initialiser le contr√¥leur avec ses d√©pendances
function CoinController.initialize(deps)
	SoundManager = deps.SoundManager
	CollectEffects = deps.CollectEffects
	CameraEffects = deps.CameraEffects
end

-- G√©rer l'√©v√©nement de collecte
function CoinController.onCoinCollected(amount, color)
	print("üí∞ Collect√©! +" .. amount .. " coins")

	-- Son de collecte avec variation de pitch
	if SoundManager then
		SoundManager.playVariedSound("CoinCollect")
	end

	-- Effets visuels
	if CollectEffects then
		CollectEffects.showCircle(color)
	end

	if CameraEffects then
		CameraEffects.shake()
	end
end

-- Connecter aux √©v√©nements
function CoinController.connect()
	local remotesFolder = ReplicatedStorage:WaitForChild("Remotes", 10)
	if not remotesFolder then
		warn("‚ùå CoinController: Impossible de trouver le dossier Remotes!")
		return
	end

	local coinCollectedEvent = remotesFolder:WaitForChild("CoinCollected", 5)
	if not coinCollectedEvent then
		warn("‚ùå CoinController: Impossible de trouver CoinCollected!")
		return
	end

	-- √âcouter les collectes
	coinCollectedEvent.OnClientEvent:Connect(function(amount, color)
		CoinController.onCoinCollected(amount, color)
	end)

	print("‚úÖ CoinController connect√©")
end

return CoinController
