--[[
	SystÃ¨me de commandes admin REFACTORISÃ‰
	Utilise le CommandRegistry pour charger automatiquement toutes les commandes

	Architecture modulaire:
	- Chaque commande = 1 fichier dans commands/
	- Chargement automatique
	- Facile d'ajouter de nouvelles commandes
]]

local CommandRegistry = require(script.Parent.commands.CommandRegistry)

local AdminCommands = {}

-- Liste des admins (par Username ou UserId)
AdminCommands.ADMINS = {
	["HiShikuro"] = true, -- Toi
	-- Ajoute d'autres admins ici:
	-- ["AutreNom"] = true,
	-- [123456789] = true, -- Par UserId
}

-- Initialiser le systÃ¨me de commandes
function AdminCommands.init()
	print("ğŸ‘‘ Initialisation AdminCommands...")

	-- Charger toutes les commandes depuis le dossier commands/
	local commandsFolder = script.Parent.commands
	CommandRegistry:Init(commandsFolder)

	print("âœ… AdminCommands initialisÃ©")
end

-- VÃ©rifier si un joueur est admin
function AdminCommands.isAdmin(player)
	-- VÃ©rifier par nom d'utilisateur
	if AdminCommands.ADMINS[player.Name] then
		return true
	end

	-- VÃ©rifier par UserId
	if AdminCommands.ADMINS[player.UserId] then
		return true
	end

	return false
end

-- ExÃ©cuter une commande
function AdminCommands.executeCommand(player, message, gameState)
	-- VÃ©rifier si c'est une commande (commence par /)
	if message:sub(1, 1) ~= "/" then
		return false
	end

	-- Parser la commande
	local parts = {}
	for part in message:gmatch("%S+") do
		table.insert(parts, part)
	end

	local commandName = parts[1]:sub(2):lower() -- Enlever le /
	local args = {}
	for i = 2, #parts do
		table.insert(args, parts[i])
	end

	-- VÃ©rifier si c'est la commande /help (cas spÃ©cial)
	if commandName == "help" or commandName == "?" or commandName == "commands" then
		return AdminCommands.showHelp(player, gameState)
	end

	-- ExÃ©cuter la commande via le CommandRegistry
	local isAdmin = AdminCommands.isAdmin(player)
	return CommandRegistry:ExecuteCommand(player, commandName, args, gameState, isAdmin)
end

-- Afficher l'aide (cas spÃ©cial car on a besoin du CommandRegistry)
function AdminCommands.showHelp(player, _gameState)
	local isAdmin = AdminCommands.isAdmin(player)
	local output = "ğŸ“‹ COMMANDES DISPONIBLES:\n"

	local commands = CommandRegistry:GetCommandsForPlayer(player, isAdmin)

	for _, cmd in ipairs(commands) do
		output = output .. "/" .. cmd.name .. " - " .. cmd.metadata.description
		if cmd.metadata.adminOnly then
			output = output .. " [ADMIN]"
		end
		if cmd.metadata.aliases and #cmd.metadata.aliases > 0 then
			output = output .. " (alias: " .. table.concat(cmd.metadata.aliases, ", ") .. ")"
		end
		output = output .. "\n"
		output = output .. "  Usage: " .. cmd.metadata.usage .. "\n"
	end

	output = output .. "\nğŸ’¡ Nombre total de commandes: " .. #commands

	print(output)
	return true, "Liste des commandes affichÃ©e dans la console"
end

return AdminCommands
